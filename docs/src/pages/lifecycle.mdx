import { Steps } from 'nextra-theme-docs'

# 消息管理

Mahiro 介入整个消息生命周期，从而你可以在期望的时机对消息进行处理。

## 生命周期

一条 OPQ 消息经过 Mahiro 处理的顺序如下：

<Steps>
 
### 消息分发

Mahiro 对 OPQ 原生消息进行特征识别，分发至 群组、私人 两种最终渠道。
 
### 中间件处理

前置处理。注册的 [中间件](./lifecycle/middleware) 将在此时有机会修改消息体，过滤消息。

### 群组权限检验

内置的 [群组管理](./panel/group) 系统会检验消息是否在有效期内，该 Bot 账号是否有权处理消息。

### 插件运行

所有可用插件将在此阶段对消息进行处理，相关插件数据将发生变化。

### 拦截器处理

后置处理。注册的 [拦截器](./lifecycle/interceptor) 将在此时有机会做安全记录，过滤消息。

### 发送消息

消息若未被拦截器拦截，最终将被真正发送。

</Steps>

## API 调用顺序

<Steps>

### registerNativeMiddleware

 - 顺序：按注册顺序瀑布调用

### onNativeEvent

 - 顺序：并发

### registerGroupMiddleware / registerFriendMiddleware / ...

 - 顺序：按注册顺序瀑布调用

### onGroupMessage / onFriendMessage / ...

 - 顺序：并发

</Steps>
